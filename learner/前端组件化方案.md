# 前端组件化方案

## 基本目标

1. 友好的项目设计、较低的上手门槛
2. 易于维护和调试的独立方案
3. 规范化的项目工程化管理
4. 详细和功能完备的文档网站
5. 优雅的包管理方案
6. 测试

## 目标拆解

### 1. 友好的项目设计、较低的上手门槛

常规套路，我们接手一个新的仓库代码，首先，要了解仓库的相关依赖、目录结构、规范、开发逻辑等，之后的开发人员便按照此逻辑进行开发和迭代。

好的设计能够让我们快速的介入进来，无感的进行核心功能的开发，不受其项目影响。而相对的，不清晰的目录划分和无规则的逻辑会极大的增加我们的上手成本，包括日后的可维护性都会大打折扣。

因此，该设计应该能显著减少我们的上手成本，并降低我们对这些代码之外的关注点的投入。

1. 新人可以快速上手，学习门槛较低。通过简单的介绍就能够理解本项目的开发范式，并可快速投入开发。
2. 有着合理、清晰的文件目录划分，整个项目有着清晰的结构。目录的设计和功能息息相关，便于维护，并能够围绕目录结构设计做到一些功能的脚本自动化处理。

### 2. 易于维护和调试的独立方案

如何理解维护？我觉得抛开项目创建者，参与进来的其他开发人员或多或少都和维护角色有点关系。特别针对后期加入进来的开发人员而言，对于某一功能的迭代、优化、开发新特性等。

如何做到快速参与进来，接手和维护之前的功能代码呢?这一点至关重要。

1. 清晰的注释。包括但不限于一些API的说明，方法、属性的介绍。
2. 合理的拆分和目录划分。功能代码、逻辑代码、业务代码、工具代码应该有比较清晰的划分。如：相关常量定义、json配置相关代码。
3. 各组件应相对独立。在项目中的目录相对独立、在开发调试能够一定程度的相对独立、单一组件可以独立开发维护，以及在最终使用引入时。

### 3. 规范化的项目工程化管理

首先，在能够强制保证的条件下采用eslint等规范做到主要规范控制，配合vscode等工具链做到工程化方面的约束。

其次，在不能具体由工程化方面控制的地方，做到统一约束，包括目录结构的设计等，并输出规范文档，确保足够清晰简单，方便新人执行。

1. eslint + prettier + commitlint （editorconfig）。在工程化方面保证相关规范强制执行。
2. 结合目录划分结构，按照设计规划规范执行相关准则，做到统一约束。如monorepo多包管理方案，及开源社区的最佳实践等（element-plus、tdesign-vue、ant-design-vue等）。
3. 并基于第2点此约束条件，产出部分自动化脚本工具，包括但不限于路由生成、源码展示、demo演示、npm发布处理等。
4. 视情况建议在项目层面做到TypeScript的支持，做到脚本代码层面的一定约束。

### 4. 详细和功能完备的文档网站

文档网站——其功能性和重要性不言而喻，主要作为第一入口提供给用户，作为了解本项目的第一途径。

1. 第一要素：基本内容应包含，使用指南，组件API、属性、方法等相关介绍说明等。
2. 第二点：使用方式和用法展示。真实渲染环境展示效果，相关代码使用展示（demo / code）。
3. 在项目代码层面可能会涉及到与约定目录的自动化脚本生成相关，进而快速自动实现如：路由、API等相关功能。

### 5. 优雅的包管理方案

1. 最大限度的精简每个组件的引入加载代码。如：按需加载时，只加载自身相关代码。
2. 使用monorepo多包管理方案，更好的管理不同组件、工具、库的代码，统一管理npm发包。
3. 按组件能力划分基础UI组件和高级组件。基础组件采用iview等UI库的方案，整体维护，支持按需加载。高级组件独立维护，采用单独发包的方案，最大程度的做到独立，更好的维护。

### 6. 测试

1. 最基本的手动功能测试和逻辑测试，本项目提供一个example目录用于模拟真实场景，来测试组件。
2. 标准化、自动化脚本测试的方案，如：test/crypass，不过该方案需要前期投入成本，结合实际情况本项目暂不考虑。

## 方案梳理

1. 命名规范
   - 首要原则，保持命名空间唯一性，命名规范应该符合本项目整体风格，如：按照以`Ah`为前缀的形式，对组件名称进行拼接。
   - 组件目录小写命名：为了符合package.json包名的命名规则，以及在项目中保持目录名称统一，组件目录以小写字母为标准，不支持大写字母。（`pro-sqltiptree`）
   - 组件导入导出首字母大写：作为组件，按照标准化方案，导出时和引入时，应该按照首字母大写的形式，并以驼峰式写法。（`ProSqlTipTree`）
   - 工具类的相关函数名称：应该以小写字母开头，按照驼峰式名称规范，并保证具有一定的语义化。（`getSortListById`）
   - 常量类：全大写，并以下划线拼接。（`BUTTON_TYPE`）

    > 组件名称
    >
    > 1. 目录规范按照正常小写定义：`button`，目录结构见下面第三点
    >
    > 2. vue组件命名空间name为：`AhButton`
    >
    > 3. 使用时按照vue连字符形式：`<ah-button />`

    ```js
    // 组件Button
    export default {
        name: 'AhButton',
    }
    // 组件AhProSqlTipTree
    export default {
        name: 'AhProSqlTipTree',
    }
    ```

2. 采用monorepo方案，更好的版本管理，相关源码统一在 packages/* 下面维护，可以实现每个文件目录作为一个npm包发布使用。

    ```js
    ├── packages                           // packages工作目录
        ├── utils                          // 工具库
        ├── pro-sqltiptree                 // 高级组件之一，独单作为一个npm包
        ├── components                     // 基础组件，整体作为一个npm包，内部组件按需加载使用
            ├── select                     // 基础组件之一 Select，
            ├── ...       
    ```

    ```js
    // 用法示例
    import { Select } from '@ah-ailpha/components'
    import ProSqlTipTree from '@ah-ailpha/pro-sqltiptree'
    ```

3. 目录划分设计，唯一出入口，职责分明。源码文件、demo文件、文档

    ```js
    ├── examples                   // 演示目录，用于调试代码
    ├── docs                       // 文档目录，用于编写对应组件的相关文档，以及文档网站的建设配置
    ├── packages                   // packages工作目录
        ├── components             // 子项目之一 => 组件目录
    ```

    ```js
    // 基础组件示例
    ├── select                         // Select组件的开发目录
        // ├── __tests__               // 测试相关
        ├── style                      // 组件相关样式代码
        // ├── demo                    // demo演示源码目录，这里会配合开发工具和脚本实现渲染展示
        // ├── docs                    // docs文档说明
        ├── src                        // 组件源码目录
            ├── index.vue              // 组件源码
            ├── props.js               // props相关定义的声明
            ├── const.js               // 常量
        ├── index.js                   // 统一出入口
    ```

    ```js
    // 高级组件示例
    ├── packages                           // packages工作目录
        ├── pro-sqltiptree                 // 高级组件之一，独单作为一个npm包
            // ├── __tests__               // 测试相关
            // ├── examples                // 演示网站
            ├── style                      // 组件相关样式代码
            // ├── demo                    // demo演示源码目录，这里会配合开发工具和脚本实现渲染展示
            // ├── docs                    // docs文档说明
            ├── src                        // 组件源码目录
                ├── index.vue             // 组件源码
                ├── props.js               // props相关定义的声明
                ├── const.js               // 常量
            ├── index.js                   // 统一出入口
            ├── package.json               // package.json 文件
    ```

    ```js
    ├── docs
        ├── components                  // 基础组件文档目录
            ├── button.md               // button 组件相关文档
            ├── select.md               // select 组件相关文档
        ├── pro-components              // 高级组件文档目录
            ├── sqltiptree.md           // sqltiptree 组件相关文档
    ```

4. 开发调试和编译打包

    - 基于公司项目背景考虑，目前构建工具主要还是走Webpack方案，求稳，兼容老旧的方案
    - 开发调试为了寻求体验统一目前也与Webpack保持一致
    - 在打包构建层面做到绝对的依赖拆分，组件分离，支持按需加载

----

## 当前计划

本项目主要结合实际业务场景积淀，产出各不同使用场景的组件。目前主要分为原始UI组件、基础组件、高级业务组件。

- **原始UI组件**：主要为开源第三方UI组件，该项目为 iview，在此基础上会做一些符合本公司业务主题风格的调整，但基本逻辑应保持原有不变。
- **基础组件**：指在UI组件之上改造和迭代了一些功能逻辑，或基于vue自行开发的组件。这里的定义应该是在依赖中应该只涉及到`vue`、`iview`等依赖。
- **高级组件**：大部分是具有高度限定使用场景的业务组件，以及涉及到基础组件的复杂功能封装，或基于其他第三方依赖库进行的二次封装开发。其特征应该是涉及核心依赖之外又包括多个其他依赖的，具有一定的相对独立性，可以且适合单独进行维护的一些组件。这类组件只在需要时进行安装使用。

目前项目设计为文档、调试、开发三者分离

- docs目前负责文档相关的编写，包括最终的文档网站生成
- examples负责组件功能调试，模拟真实开发环境
- packages下不同子项目进行对应功能开发

## 未来规划

## 如何参与开发

本项目采用monorepo方案，使用pnpm workspaces + lerna管理，在开发之前，你需要先安装 [pnpm](https://pnpm.io/installation)。

```sh
npm install -g pnpm
```

考虑到网络问题，你可以安装nrm管理镜像源 [nrm](https://www.npmjs.com/package/nrm)

```sh
npm i nrm -g
# 查看可选源
nrm ls
# 使用源
nrm use taobao
```

### 安装依赖

1. 安装依赖

    ```sh
    # 默认会安装所有子项目的依赖
    pnpm install
    ```

    ```sh
    # 安装到全局 -w
    pnpm add -DW <package-name>
    ```

2. 安装到指定子项目中

    ```sh
    pnpm add <package-name> --filter <target-package-name>

    # 比如要将lodash装到package-a下
    pnpm add dayjs --filter @ah-ailpha/package-a
    ```

    或者你也可以单独进入到需要的工作区安装依赖

    ```sh
    cd package-a && pnpm i xx -D
    ```

3. 创建或进入子项目中进行开发

## 如何使用

### 安装

```bash
# 基础组件
npm i --save @ah-ailpha/components
# 高级组件
npm i --save @ah-ailpha/pro-sqltiptree
```

### 注册

如果使用 Vue 默认的模板语法，需要注册组件后方可使用，有如下三种方式注册组件：

**全局完整注册**

```js
import AhComponents from '@ah-ailpha/components'
import AhProSqlTipTree from '@ah-ailpha/pro-sqltiptree'

app.use(AhComponents).use(AhProSqlTipTree)
```

**全局部分注册**

```js
import { Button } from '@ah-ailpha/components';

app.use(Button)
```

**局部注册组件**

```html
<template>
    <ah-button type="primary">Primary Button</ah-button>
    <ah-proSqlTipTree>AhProSqlTipTree组件</ah-proSqlTipTree>
</template>
<script>
  import { Button } from 'ant-design-vue';
  import ProSqlTipTree from '@ah-ailpha/pro-sqltiptree'
  // import AhProSqlTipTree from '@ah-ailpha/pro-sqltiptree'

  export default {
    components: {
      AhButton: Button,
      AhProSqlTipTree: ProSqlTipTree
      // AhProSqlTipTree
    },
  };
</script>
```

局部注册组件需要保证组件命名空间符合约定规则，即 `Ah`为前缀，因为该场景下是手动自行注册，组件`name`不可控，不同于全局`Vue.use`会自动使用定义的`name`完成注册。
